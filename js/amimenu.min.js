function setRadiusActive(){document.body.style.cursor="crosshair";map.on("click",function a(b){liveRadiusSearch(b.latlng.lat,b.latlng.lng);map.off("click",a);$("#iconoradius").removeClass("activeicon");document.body.style.cursor="default";return false});$("#iconoradius").addClass("activeicon")}function onLocationFound(a){var b=a.accuracy/2;var c=new L.Marker(a.latlng,{icon:icon});map.addLayer(c);$.jStorage.set("lastlat",a.latlng.lat);$.jStorage.set("lastlng",a.latlng.lng);var d=new L.Circle(a.latlng,b);map.addLayer(d);liveRadiusSearch(a.latlng.lat,a.latlng.lng)}function geoLocate(){map.locate({setView:true,maxZoom:17})}function getLocate(a,b){var c="http://nominatim.openstreetmap.org/reverse?email=slaptot@gmail.com&accept-language=en_EN&format=json&lat="+a+"&lon="+b+"&zoom=18&addressdetails=1";$.getJSON(c,function(a){var b=a.address.city;var c=a.address.state;var d=a.address.country;var e=a.address.postcode;$("#city").val(b);$("#state").val(c);$("#country").val(d);$("#postcode").val(e);$("#addresse").val(a.display_name)})}function initRegistration(){map.addEventListener("click",onMapClick);document.body.style.cursor="crosshair";return false}function cancelEdit(){newUser.clearLayers();$("#editSuccessModal").modal("hide");document.body.style.cursor="default";map.removeEventListener("click",onMapClick)}function cancelRegistration(){newUser.clearLayers();$("#registerModal").modal("hide");document.body.style.cursor="default";map.removeEventListener("click",onMapClick)}function getCountries(){$.getJSON("getcountries.php",function(a){for(var b=0;b<a.length;b++){var c=a[b].pay;$("#listcountries").append("<li><a href='#' onClick='getState(\""+a[b].pay+"\")'>"+a[b].pay+"</a></li>")}})}function changeNameCity(a){$("#namecity").empty();$("#namecity").html(a+" <b class='caret'></b>")}function changeNameState(a){$("#namestate").empty();$("#namestate").html(a+" <b class='caret'></b>")}function getState(a){$.jStorage.set("lastcountry",a);$("#namestate").html("- <b class='caret'></b>");$("#namecity").html("- <b class='caret'></b>");$("#namecountry").html(a+' <b class="caret"></b>');$("#liststates").empty();$("#listcities").empty();liveSearch("state",a);$.getJSON("getstates.php?country="+a,function(a){for(var b=0;b<a.length;b++){$("#liststates").append("<li><a href='#' onClick='getCities(\""+a[b].departement+'");liveSearch("state","'+a[b].departement+'");changeNameState("'+a[b].departement+"\");'>"+a[b].departement+"</li>")}})}function getCities(a){$.jStorage.set("laststate",a);$("#namecity").html("- <b class='caret'></b>");$("#listcities").empty();liveSearch("country",a);$.getJSON("getcities.php?state="+a,function(a){for(var b=0;b<a.length;b++){$("#listcities").append("<li><a href='#' onClick='liveSearch(\"city\",\""+a[b].ville+'");changeNameCity("'+a[b].ville+'");$(".nav-collapse").collapse("toggle");\'>'+a[b].ville+"</li>")}})}function setListItems(a){$(".thumbnails").empty();for(var b=0;b<a.length;b++){var c=new L.LatLng(a[b].glat,a[b].glng);var d=a[b].nom;var e='<li class="span6"><div class="thumbnail"><img src="uploads/150_'+a[b].img+'" alt=""><div class="caption"><h5>'+d+"</h5><p>"+a[b].intro+'</p><p><a href="#" onClick="getRestaurant('+a[b].id+')" class="btn btn-primary">Go</a>';if(a[b].tel){e+='<a a href="tel:'+a[b].tel+'" class="btn">Call</a>'}e+="</p></div></div></li>";$(".thumbnails").append(e)}}function liveRadiusSearch(a,b){users.clearLayers();var c=$("#radiustosend").html();$.jStorage.set("lastradius",c);$.jStorage.set("lastlat",a);$.jStorage.set("lastlng",b);$.getJSON("getbusinessradius.php?lat="+a+"&lng="+b+"&radius="+c,function(a){for(var b=0;b<a.length;b++){var c=new L.LatLng(a[b].glat,a[b].glng);var d=a[b].nom;if(a[b].nom!=null){var e="<div style='font-size: 18px; color: #0078A8;'><a href='#' onClick='getRestaurant("+a[b].id+");'>"+a[b].nom+"</a><br/><a href='tel:"+a[b].tel+"'>"+a[b].tel+"</a><article>"+a[b].intro+"</article></div>";if(a[b].ville!=null){var f="<div style='font-size: 14px;'>"+a[b].ville+"</div>"}else{var f=""}var g=new L.Marker(c);g.bindPopup("<div style='text-align: center; margin-left: 10px; margin-right: 10px;'>"+e+f+"<span><a rel='localize[btntoque]' class='btn btn-success btn-small' onClick='opentoque("+a[b].tel+");'>Toque</a></span></div>",{maxWidth:"250",minWidth:"150"});users.addLayer(g)}}setListItems(a)}).complete(function(){map.fitBounds(users.getBounds());if(firstLoad==true){map.fitBounds(users.getBounds());firstLoad=true}})}function liveSearch(a,b){users.clearLayers();if(a=="city"){$.jStorage.set("lastcity",b)}$.getJSON("get_restaurants.php?"+a+"="+b,function(a){for(var b=0;b<a.length;b++){var c=new L.LatLng(a[b].glat,a[b].glng);var d=a[b].nom;if(a[b].nom!=null){var e="<div style='font-size: 18px; color: #0078A8;'><a href='#' onClick='getRestaurant("+a[b].id+")'>"+a[b].nom+"</a><br/><a href='tel:"+a[b].tel+"'>"+a[b].tel+"</a><article>"+a[b].intro+"</article></div>";if(a[b].ville!=null){var f="<div style='font-size: 14px;'>"+a[b].ville+"</div>"}else{var f=""}var g=new L.Marker(c);g.bindPopup("<div style='text-align: center; margin-left: 10px; margin-right: 10px;'>"+e+f+"<span><a rel='localize[btntoque]' class='btn btn-success btn-small' onClick='opentoque("+a[b].tel+");'>Toque</a></span></div>",{maxWidth:"250",minWidth:"150"});users.addLayer(g)}}setListItems(a)}).complete(function(){map.fitBounds(users.getBounds());if(firstLoad==true){map.fitBounds(users.getBounds());firstLoad=true}})}function getRestaurants(){$.getJSON("get_restaurants.php",function(a){for(var b=0;b<a.length;b++){var c=new L.LatLng(a[b].glat,a[b].glng);var d=a[b].nom;if(a[b].nom!=null){var e="<div style='font-size: 18px; color: #0078A8;'><a href='#' onClick='getRestaurant("+a[b].id+")'>"+a[b].nom+"</a><br/><a href='tel:"+a[b].tel+"'>"+a[b].tel+"</a>";if(a[b].intro!=null&&a[b].intro!="null"){e+="</div>"}else{e+="</div>"}if(a[b].ville!=null){var f="<div style='font-size: 14px;'>"+a[b].ville+"</div>"}else{var f=""}var g=new L.Marker(c);g.bindPopup("<div style='text-align: center; margin-left: 10px; margin-right: 10px;'>"+e+f+"<span><a rel='localize[btntoque]' class='btn btn-success btn-small' onClick='opentoque("+a[b].tel+");'>Toque</a></span></div>",{maxWidth:"300",minWidth:"150"});users.addLayer(g)}}setListItems(a)}).complete(function(){if(firstLoad==true){map.fitBounds(users.getBounds());firstLoad=false}})}function opentoque(a){$("#dartoqueModal").modal("show");$("#teltosend").html(a)}function prepareUpload(){document.getElementById("fileSize").innerHTML="";file=document.getElementById("fileToUpload").value;if(file.lastIndexOf("\\")>=0)file=file.substr(file.lastIndexOf("\\")+1);document.getElementById("fileName").innerHTML=file;var a=window.location.href;if(a[a.length-1]!="/")a=a.substring(0,a.lastIndexOf("/")+1);document.getElementById("target").innerHTML=a;document.getElementById("inputform").action=a}function insertRestaurant(){var a=$("#name").val();var b=$("#phone").val();var c=$("#intro").val();var d=$("#email").val();var e=$("#website").val();var f=$("#city").val();var g=$("#lat").val();var h=$("#lng").val();var i=$("#mondaymenu").val();var j=$("#tuesdaymenu").val();if(a.length==0){$("#checkform").val("Name is required!");$("#checkerror").show();return false}if(d.length==0){alert("Email is required!");return false}var k="name="+a+"&intro="+c+"&phone="+b+"&email="+d+"&website="+e+"&city="+f+"&lat="+g+"&lng="+h+"&introlunes="+i+"&intromartes="+j+"&fileToUpload="+file;$.ajax({type:"POST",url:"insert_restaurant.php",data:k,success:function(){cancelRegistration();users.clearLayers();getCountries();getRestaurants();$("#insertSuccessModal").modal("show")},error:function(){cancelRegistration();users.clearLayers();$("#insertFailModal").modal("show")},complete:function(){cancelRegistration();users.clearLayers();getCountries();getRestaurants();$("#insertSuccessModal").modal("show")}});return false}function getRestaurantToEdit(a){$.jStorage.set("lastrestedit",a);$.getJSON("get_restaurant.php?restaurantid="+a,function(a){for(var b=0;b<a.length;b++){var c=a[b].id;$("#idrestedit").val(c);var d=a[b].img;if(d!=null){$("#imageedit").attr("src","uploads/50_"+d);$("#completeimagesource").attr("src","uploads/500_"+d)}else{$("#imageedit").attr("src","uploads/pordefecto.png");$("#completeimagesource").attr("src","uploads/pordefecto.png")}var e=a[b].nom;$("#nameedit").val(e);$("#nombreimagenrestedit").text(e);var f=a[b].codepostal;$("#postcodeedit").val(f);var g=a[b].departement;$("#stateedit").val(g);var h=a[b].pay;$("#countryedit").val(h);var i=a[b].adresse;$("#addresseedit").val(i);var j=a[b].ville;$("#cityedit").val(j);var k=a[b].glat;$("#latedit").val(k);var l=a[b].glng;$("#lngedit").val(l);var m=a[b].tel;$("#phoneedit").val(m);var n=a[b].tel2;$("#mobileedit").val(n);var o=a[b].adresse;$("#addressedit").val(o);var p=a[b].email;$("#emailedit").val(p);$("#emailedit").attr("href","mailto:"+p);var q=a[b].web;$("#websiteedit").val(q);$("#websiteedit").attr("href",q);var r=a[b].intro;if(r!=null){$("#introedit").val(r)}var s=a[b].introlunes;if(s!=null){$("#introlunesedit").val(s)}var t=a[b].intromartes;if(t!=null){$("#intromartesedit").val(t)}var u=a[b].intromiercoles;if(u!=null){$("#intromiercolesedit").val(u)}var v=a[b].introjueves;if(v!=null){$("#introjuevesedit").val(v)}var w=a[b].introviernes;if(w!=null){$("#introviernesedit").val(w)}var x=a[b].introsabado;if(x!=null){$("#introsabadoedit").val(x)}var y=a[b].introdomingo;if(y!=null){$("#introdomingoedit").val(y)}}}).complete(function(){})}function getRestaurant(a){$.getJSON("get_restaurant.php?restaurantid="+a,function(b){for(var c=0;c<b.length;c++){var d=b[c].img;if(d!=null){$("#detailsimage").attr("src","uploads/50_"+d);$("#completeimagesource").attr("src","uploads/500_"+d)}else{$("#detailsimage").attr("src","uploads/pordefecto.png");$("#completeimagesource").attr("src","uploads/pordefecto.png")}var e=b[c].nom;$("#detailsname").text(e);$("#nombreimagenrest").text(e);var f=b[c].tel;$("#detailsphone").text(f);var g=b[c].tel2;$("#detailsmobile").text(g);var h=b[c].adresse;$("#detailsaddress").text(h);var i=b[c].email;$("#detailsmail").text(i);$("#detailsmail").attr("href","mailto:"+i);var j=b[c].web;$("#detailsweb").html(j);$("#detailsweb").attr("href",j);var k=b[c].intro;if(k!=null){$("#detailsinfo").html(k)}var l=b[c].introlunes;if(l!=null){$("#introlunesdetail").html(l)}var m=b[c].intromartes;if(m!=null){$("#intromartesdetail").html(m)}var n=b[c].intromiercoles;if(n!=null){$("#intromiercolesdetail").html(n)}var o=b[c].introjueves;if(o!=null){$("#introjuevesdetail").html(o)}var p=b[c].introviernes;if(p!=null){$("#introviernesdetail").html(p)}var q=b[c].introsabado;if(q!=null){$("#introsabadodetail").html(q)}var r=b[c].introdomingo;if(r!=null){$("#introdomingodetail").html(r)}$("#shareme").attr("data-url","http://amimenu.mowaps.com/details.php?detailid="+a);$("#shareme").sharrre({share:{twitter:true,facebook:true,pinterest:true,google:true},template:'<div class="box"><div id="sharename" class="left">Share</div><div class="middle"><a href="#" class="facebook">f</a><a href="#" class="twitter">t</a><a href="#" class="pinterest">p</a><a href="#" class="googleplus">+1</a></div><div class="right">{total}</div></div>',enableHover:false,enableTracking:true,render:function(a,b){$(a.element).on("click",".twitter",function(){a.openPopup("twitter")});$(a.element).on("click",".facebook",function(){a.openPopup("facebook")});$(a.element).on("click",".googleplus",function(){a.openPopup("googlePlus")});$(a.element).on("click",".pinterest",function(){a.openPopup("pinterest")})}})}}).complete(function(){$("#restaurantDetails").modal("show")})}function sendToque(){var a=$("#name_toque").val();var b=$("#email_toque").val();var c=$("#phone_toque").val();var d=$("#teltosend").html();if(a.length==0){alert("Name is required!");return false}if(b.length==0){alert("Email is required!");return false}if(c.length==0){alert("Phone is required!");return false}var e="email="+b+"&usuario="+c+"&name="+a+"&phonerest="+d+"&callback=0";$.ajax({url:"freesms.php",data:e,success:function(a){if(a==0){$("#oksms").show()}else if(a==1){$("#failsms").show()}else{$("#tellsms").show()}}});return false}function removeRestaurant(){var a=$("#email_remove").val();var b=$("#token_remove").val();if(a.length==0){alert("Email is required!");return false}if(b.length==0){alert("Token is required!");return false}var c="email="+a+"&token="+b;$.ajax({type:"POST",url:"remove_restaurant.php",data:c,success:function(a){if(a>0){$("#removemeModal").modal("hide");users.clearLayers();getRestaurants();$("#removeSuccessModal").modal("show")}else{alert("Incorrect email or token. Please try again.")}}});return false}function editRestaurant(){var a=$("#email_edit").val();var b=$("#token_edit").val();if(a.length==0){alert("Email is required!");return false}if(b.length==0){alert("Token is required!");return false}var c="email="+a+"&token="+b;$.getJSON("edit_restaurant.php?"+c,function(a){for(var b=0;b<a.length;b++){console.log(a[b].id);if(a.length>0){getRestaurantToEdit(a[b].id);$("#editmeModal").modal("hide");$("#editSuccessModal").modal("show")}else{alert("Incorrect email or token. Please try again.")}}});return false}function onMapClick(a){var b=a.latlng.lat.toFixed(6);$("#lat").val(b);$("#lng").val(a.latlng.lng.toFixed(6));$("#registerModal").modal("show");getLocate(b,a.latlng.lng.toFixed(6))}jQuery(".toggleToMap").click(function(){jQuery("#map").showMap();jQuery(".nav-collapse").collapse("toggle")});jQuery(".toggleWidth").click(function(){jQuery("#mapcontentlist").slideToggleWidth();jQuery("#map").slideToggleWidth()});jQuery.fn.extend({showMap:function(){jQuery(this).animate({width:"show"});jQuery("#mapcontentlist").animate({width:"hide"})},slideRight:function(){return this.each(function(){jQuery(this).animate({width:"show"})})},slideLeft:function(){return this.each(function(){jQuery(this).animate({width:"hide"})})},slideToggleWidth:function(){return this.each(function(){var a=jQuery(this);if(a.css("display")=="none"){a.slideRight()}else{a.slideLeft()}})}});var map,newUser,users,mapquest,firstLoad;firstLoad=true;var LeafIcon=L.Icon.extend({options:{iconUrl:"markerMe.png",shadowUrl:"marker-shadow.png",iconSize:new L.Point(25,41),shadowSize:new L.Point(25,41)}});var icon=new LeafIcon;users=new L.FeatureGroup;newUser=new L.LayerGroup;mapquest=new L.TileLayer("http://{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png",{maxZoom:17,minZoom:4,subdomains:["otile1","otile2","otile3","otile4"],attribution:'<img width="90" src="img/logoheader.png"/>'});map=new L.Map("map",{center:new L.LatLng(40.430224,-3.713379),zoom:8,layers:[mapquest,users,newUser]});map.addControl(new L.Control.Scale);$(document).ready(function(){$.ajaxSetup({cache:false,scriptCharset:"utf-8",contentType:"application/json; charset=utf-8"});$("#map").css("height",$(window).height()-120);if($(window).width()<500){$("#mapcontentlist").css("margin-top","-10px");$("#mapcontentlist").css("height",$(window).height()-120)}else{$("#mapcontentlist").css("margin-top","10px");$("#mapcontentlist").css("height",$(window).height()-100);$("#map").css("margin-top","60px")}getRestaurants()});$(window).resize(function(){$("#map").css("height",$(window).height()-120);if($(window).width()<500){$("#mapcontentlist").css("margin-top","-10px");$("#mapcontentlist").css("height",$(window).height()-120)}else{$("#mapcontentlist").css("margin-top","10px");$("#mapcontentlist").css("height",$(window).height()-100)}}).resize();map.on("locationfound",onLocationFound);var file